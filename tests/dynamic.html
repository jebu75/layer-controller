<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="description" content="A layer loading and control widget for esrijs.">
<meta name="author" content="btfou">
<title>Layer Controller</title>
<!-- loading fonts with xstyle can result in unseemly font changes as text is rendered before css is loaded -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,800" rel="stylesheet">
<!-- Font Awesome is required!!! -->
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" rel="stylesheet">
<style type="text/css">
html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
}
body {
    font: 12px 'Open Sans', sans-serif;
}
</style>
</head>
<body class="claro">
<div id="container"></div>
<script>dojoConfig = {async: true, packages: [{name: 'gis', location: location.pathname.replace(/[^\/]+$/, '') + 'js/gis'}]};</script>
<script src="//js.arcgis.com/3.10compact/"></script>
<script>
var map, layerController; //dev
require([
    'dijit/layout/BorderContainer',
    'dijit/layout/ContentPane',
    'esri/config',
    'esri/tasks/GeometryService',
    'esri/map',
    'esri/graphic',
    'esri/layers/ImageParameters',
    'gis/dijit/LayerController',
    'xstyle/css!dijit/themes/claro/claro.css',
    'xstyle/css!esri/css/esri.css',
    'dojo/domReady!'
], function (
    BC,
    CP,
    esriConfig,
    GeometryService,
    Map,
    Graphic,
    ImageParameters,
    LayerController
) {
    'use strict';
    
    //layout
    var bc = new BC({liveSplitters: false, style: 'width:100%;height:100%;z-index:1;'}, 'container');
    bc.startup();
    bc.addChild(new CP({region: 'left', content: '<h2 style="margin:0 0 6px 0;">Layer Controller</h2><div id="layer-controller"></div>', style: 'width:300px;z-index:1;'}));
    bc.addChild(new CP({region: 'center', id: 'map', style: 'padding:0;overflow:hidden;z-index:1;'}));
    
    //layer controller uses default geom srv for zooming to layer extent if not in map sr
    esriConfig.defaults.geometryService = new GeometryService('http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer');
    
    //map
    map = new Map('map', {basemap: 'topo', center: [-123.3, 45.9], zoom: 11});
    
    //application graphics layers for results, measure, draw, etc
    //added to map bottom to top
    var applicationLayers = {
        top: [{
            layerOptions: {
                id: 'gl_results'
            },
            layerExtend: {
                print: false
            }
        }, {
            layerOptions: {
                id: 'gl_measure'
            },
            layerExtend: {
                print: false
            }
        }],
        bottom: [{
            layerOptions: {
                id: 'polygon_draw_layer'
            },
            layerExtend: {
                print: true
            }
        }, {
            layerOptions: {
                id: 'points_draw_layer'
            },
            layerExtend: {
                print: true
            }
        }]
    };
    
    //service layers, etc
    var operationalLayers = [{
        type: 'dynamic',
        title: 'Oregon Wetlands',
        url: 'http://venison.library.oregonstate.edu/arcgis/rest/services/wetlands/wetlands_restoration_Feb_2014/MapServer',
        //token: 'abcde12345', //better options for auth but will load with token
        //minScale: 0, //will set if present - too bad these aren't layer options swingley?
        //maxScale: 0,
        layerOptions: {
            id: 'orwetlands', //optional - see 'control-added' event for accessing map assigned id
            visible: false,
            opacity: 1,
            imageParameters: new ImageParameters({dpi: 96, format: 'PNG32'}) //yo! sublayer transparency
        },
        //layer: {esri layer object},
        layerExtend: {
            print: true,
            foo: 'bar'
        },
        controlOptions: {
            //sublayers: false, //defaults to true - false = no sublayer controls
            components: [],
            layerMenuItems: [{
                label: 'Layer Menu Item',
                onClick: function () { alert('esrijs rocks. dojo too.') }
            }],
            sublayerMenuItems: [{
                label: 'Sublayer Menu Item',
                onClick: function () { alert('esrijs rocks. dojo too.') }
            }]
        }
    }];
    
    //layer controller
    layerController = new LayerController({
        map: map,
        components: [],
        operationalLayers: operationalLayers,
        applicationLayers: applicationLayers,
        reorder: true,
        basemapCount: 1
    }, 'layer-controller');
    layerController.startup();
});
</script>
</body>
</html>
